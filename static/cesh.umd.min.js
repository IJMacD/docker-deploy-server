!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).cesh={})}(this,(function(e){"use strict";function t(e,t){const s=[];let o=0;for(const r of t)r.start>o&&s.push(n(e.substring(o,r.start))),o=r.start+r.length,s.push(`<span class="${r.type}">${n(e.substring(r.start,o))}</span>`);return o<e.length&&s.push(n(e.substring(o))),s.join("")}function n(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))}function s(e,t){const n=()=>{t.style.width=`${e.offsetWidth}px`,t.style.height=`${e.offsetHeight}px`},s=new ResizeObserver(n);return s.observe(e),n(),()=>s.disconnect()}function o(e,t){const n=()=>{t.style.top=`${e.offsetTop}px`,t.style.left=`${e.offsetLeft}px`};n();const s=setInterval(n,100);return()=>clearInterval(s)}function r(e,t){const n=()=>{t.scrollLeft=e.scrollLeft,t.scrollTop=e.scrollTop};return e.addEventListener("scroll",n),()=>e.removeEventListener("scroll",n)}const i=e=>(n,s)=>{const o=()=>{let o=n.value,r=[];try{r=e(o)}catch(e){}"\n"===o[o.length-1]&&(o+=" "),s.innerHTML=t(o,r)};n.addEventListener("keyup",o),n.addEventListener("input",o);const r=()=>{"visible"===document.visibilityState&&o()};return document.addEventListener("visibilitychange",r),o(),()=>{n.removeEventListener("keyup",o),n.removeEventListener("input",o),document.removeEventListener("visibilitychange",r)}};function c(e,t){const n=e.lastIndexOf("\n",t-1);return n<0?0:n+1}function l(e){const t=t=>{if("Tab"===t.key){t.preventDefault();const n=e.selectionStart,s=e.selectionEnd,{value:o}=e,r=c(o,n);if(n===s)if(t.shiftKey){const t=/ {1,4}/y;t.lastIndex=r;const s=t.exec(o);if(s){const t=s[0].length;e.value=o.substring(0,r)+o.substring(r+t),e.selectionStart=n-t,e.selectionEnd=n-t}}else{const t=(n-r)%4,s=0===t?4:4-t;e.value=o.substring(0,n)+" ".repeat(s)+o.substring(n),e.selectionStart=n+s,e.selectionEnd=n+s}else{const i=o.substring(r,s);if(t.shiftKey){const t=/(^|\n)    /g,c=i.replace(t,(e=>"\n"===e[0]?"\n":"")),l=[...i.matchAll(t)].length;e.value=o.substring(0,r)+c+o.substring(s),e.selectionStart=n-4,e.selectionEnd=s-4*l}else{const t=i.replace(/\n/g,"\n    "),c=i.replace(/[^\n]/g,"").length+1;e.value=o.substring(0,r)+"    "+t+o.substring(s),e.selectionStart=n+4,e.selectionEnd=s+4*c}}}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}function u(e){const t=t=>{if("Enter"===t.key){const n=e.selectionStart,{value:s}=e,o=c(s,n),r=/ +/gy;r.lastIndex=o;const i=r.exec(s);if(i){t.preventDefault();const o=i[0].length;e.value=s.substring(0,n)+"\n"+" ".repeat(o)+s.substring(n),e.selectionStart=n+o+1,e.selectionEnd=n+o+1}}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}function a(e){const t=t=>{const n={"'":"'",'"':'"',"(":")","{":"}","[":"]"};if(n[t.key]){const s=e.selectionStart,o=e.selectionEnd;if(o-s>0){t.preventDefault();const{value:r}=e;e.value=r.substring(0,s)+t.key+r.substring(s,o)+n[t.key]+r.substring(o),e.selectionStart=s+1,e.selectionEnd=o+1}}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}function f(e,t){const n=[];for(let s=0;s<e.length;){let o;for(const[r,i]of Object.entries(t))if(i.lastIndex=s,o=i.exec(e)){const e=o[0].length;if(0===e)throw Error(r);n.push({type:r,start:s,length:e}),s+=e;break}o||s++}return n}e.editor=function(e,{tokenizer:t,plugins:n=[l,u,a]}){return function(e,t){if("string"==typeof e){const t=document.querySelector(e);t&&(e=t)}if(!(e instanceof HTMLTextAreaElement))return void console.warn("[Cesh] Not a textarea");const n=e.parentElement;if(!n)return;const s=e,o=document.createElement("div");n.insertBefore(o,e),s.classList.add("cesh-textarea"),o.classList.add("cesh-editor"),n.style.position="relative",o.style.position="absolute";const r=[];for(const e of t){const t=e(s,o);t&&r.push(t)}return{destroy(){n.removeChild(o),s.classList.remove("cesh-textarea");for(const e of r)e()}}}(e,[i(t),r,s,o,...n])},e.enterPlugin=u,e.fontPlugin=function(e,t){const n=getComputedStyle(e);for(const[e,s]of Object.entries(n))e.startsWith("font")&&(t.style[e]=s)},e.jsTokenizer=function(e){return f(e,{comment:/\/\*.*?\*\/|\/\/[^\n]*?\n/gsy,keyword:/\b(var|let|const|return|if|for|of|in|while|yield|function|async|await|null|undefined|import|export|as|from|assert|delete|typeof|instanceof|void|new|super|class|extends|constructor|get|set|static)\b/gy,number:/-?\d+(\.\d+)?([eE][+-]?\d+)?/gy,name:/#?\w+/gy,string:/'[^'\n]*'|"[^"\n]*"|`[^`]*`/gy,punctuation:/:|,|\(|\)|{|}|;/gy,regex:/\/[^\n]*?[^\\]\/[dgimsuvy]*/gy,operator:/\?\?=|\|\|=|&&=|\|=|\^=|&=|>>>=|>>=|<<=|\*\*=|%=|\/=|\*=|-=|\+=|===|==|=|!==|!=|!|>=|>|<=|<|%|\+\+|--|-|\+|\*\*|&&|\|\||&|\||\^|~|<<|>>>|>>|\?/gy})},e.markup=t,e.quotesPlugin=a,e.sqlTokenizer=function(e){return f(e,{keyword:/\b(SELECT|DISTINCT|FILTER|FROM|LEFT|RIGHT|INNER|OUTER|FULL|JOIN|ON|WHERE|ORDER BY|OR|AND|IN|AS|OVER|PARTITION BY|UNBOUNDED|PRECEDING|FOLLOWING|FETCH|FIRST|NEXT|ROW|ROWS|ONLY|WINDOW|HAVING|LIMIT|OFFSET|EXPLAIN|CREATE|TEMP|TABLE|VIEW|INSERT INTO|VALUES|UPDATE|SET|DELETE|DROP|TRUNCATE|EXCEPT|INTERSECT|UNION ALL|UNION)\b/gy,number:/-?\d+(\.\d+)?/gy,name:/\w+|"[^"]*"/gy,string:/'[^']*'/gy,punctuation:/\*|,|\(|\)/gy})},e.tabPlugin=l,e.twigTokenizer=function(e){const t=f(e,{punctuation:/{{[-~]?|[-~]?}}|{%[-~]?|[-~]?%}/gy,keyword:/\b(for|in|endfor|if|endif|block|endblock|apply|endapply|autoescape|endautoescape|set|extends)\b/gy,operator:/(\b(b-and|b-xor|b-or|not|or|and|in|matches|starts with|ends with|has every|has some)\b)|\?:|\?|:|==|!=|<=>|<|>|>=|<=|\.\.|\+|-|~|\*|\/|\/\/|%|is|\*\*|\?\?|\||\[|\]\./gy,number:/-?\d+(\.\d+)?/gy,string:/'[^']*'|"[^"]*"/gy,comment:/{#.*?#}/gsy,name:/\w+/gy}),n=[];let s=!1;for(const o of t)if((s||"comment"===o.type)&&n.push(o),"punctuation"===o.type){const t=e.substring(o.start,o.start+2);"{{"===t||"{%"===t?(s=!0,n.push(o)):s=!1}return n}}));
